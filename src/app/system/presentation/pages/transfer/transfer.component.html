<div class="d-flex flex-column align-items-center justify-content-center">
  <div class="card">
    <div class="card-header">
      <h2 class="mb-3">Checkout</h2>
    </div>
    <div class="card-body fs-3">
      @for (item of data; track $index) {
      <div class="mb-3 d-flex align-items-center gap-3">
        <div class="position-relative">
          <img
            src="{{ item.imageUrl }}"
            class="img-fluid rounded"
            style="width: 150px; height: auto"
            alt="{{ item.title }}"
          />

          <span
            class="position-absolute translate-middle badge rounded-circle bg-warning"
            style="
              font-size: 0.75rem;
              width: 30px;
              height: 30px;
              display: flex;
              align-items: center;
              justify-content: center;
              left: 88%;
              top: 10%;
            "
          >
            {{ item.quantity }}
          </span>
        </div>

        <div class="flex-grow-1">
          <p class="mb-1">
            <strong>{{ item.title }}</strong>
          </p>
          <p class="fw-bold mb-0">
            ₹{{ (item.quantity * item.numericPrice).toFixed(2) }}
          </p>
        </div>
      </div>
      }
    </div>
  </div>
</div>

<div class="card mt-4">
  <div class="card-body bg-dark-subtle">
    <p class="text-center fw-bold">
      PLEASE CLICK THE PAY NOW BUTTON BELOW TO COMPLETE THE PAYMENT AGAINST THIS
      ORDER
    </p>
  </div>
</div>
<div class="mt-2 d-flex justify-content-center">
  <button
    class="btn rounded text-center col-sm-7 col-md-4 col-lg-3 fs-4 text-bg-primary"
    data-bs-toggle="modal"
    data-bs-target="#payment"
  >
    Scan & Pay Now
  </button>
  <button
    class="btn rounded ms-4 col-lg-1 col-md-4 col-sm-4 fs-4 text-bg-danger"
    routerLink="../../app/checkout"
  >
    Cancel
  </button>
</div>
<div
  class="modal col-lg-6 col-md-6 col-sm-12 top-50 start-50 translate-middle"
  id="payment"
  data-bs-backdrop="static"
  data-bs-keyboard="false"
  tabindex="-1"
  aria-labelledby="paymentLabel"
>
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content tall-modal" style="height: 80vh">
      <div class="modal-header text-bg-primary">
        <h1 class="modal-title fs-5" id="paymentLabel">Payment Portal</h1>
      </div>

      <div class="modal-body">
        <img
          [src]="url"
          width="40%"
          class="border border-dark rounded p-2 mx-auto d-block"
          alt="qr_code"
        />
        <div class="upiwc-payment-info-text mt-3 px-2 border text-center">
          Scan the QR Code with any UPI apps like BHIM, Paytm, Google Pay,
          PhonePe or any Banking UPI app to make payment for this order. After
          successful payment, enter the UPI Reference ID or Transaction Number
          and your UPI ID in the next screen and submit the form. We will
          manually verify this payment against your 12-digits UPI Reference ID
          or Transaction Number (e.g. 301422121258) and your UPI ID.
        </div>
      </div>
      <div
        class="modal-footer d-flex justify-content-between align-items-center"
      >
        <!-- Subtotal on the left -->
        <p class="fw-bold start-0 mb-0">
          ₹{{ cartService.getSubtotal().toFixed(2) }}
        </p>

        <!-- Buttons on the right -->
        <div class="d-flex gap-2">
          <button type="button" class="btn btn-danger" data-bs-dismiss="modal">
            Cancel
          </button>
          <button type="button" class="btn btn-primary">
            <a
              data-bs-toggle="modal"
              data-bs-target="#final"
              class="nav-link text-white text-decoration-none"
              >Proceed to Next</a
            >
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
<div
  class="modal top-50 start-50 translate-middle"
  id="final"
  data-bs-backdrop="static"
  data-bs-keyboard="false"
  tabindex="-1"
  aria-labelledby="finalLabel"
>
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content tall-modal" style="height: 60%">
      <div class="modal-header text-bg-primary">
        <h1 class="modal-title fs-5" id="finalLabel">Confirm Payment</h1>
      </div>

      <form #transactionForm="ngForm">
        <div class="modal-body border-1">
          <p class="fw-bolder text-center">
            Enter Transaction ID / UTR / Reference ID
          </p>

          <div class="d-flex align-items-center justify-content-center w-100">
            <input
              type="text"
              name="transaction"
              [(ngModel)]="transaction"
              #transactionModel="ngModel"
              required
              pattern="^[a-zA-Z0-9]*$"
              class="form-control rounded-4"
              placeholder="Enter transaction ID"
            />
          </div>

          <div
            class="text-danger mt-1 text-center"
            *ngIf="transactionModel.invalid && transactionModel.touched"
          >
            <div *ngIf="transactionModel.errors?.['required']">
              Transaction ID is required.
            </div>
            <div *ngIf="transactionModel.errors?.['pattern']">
              Transaction ID must be alphanumeric only.
            </div>
          </div>

          <p class="text-center mt-3 px-2 border h6">
            Please ensure that the amount has been deducted from your account
            before clicking "Confirm". We will manually verify your transaction
            once submitted.
          </p>
        </div>
      </form>

      <div
        class="modal-footer d-flex justify-content-between align-items-center"
      >
        <button
          type="button"
          class="btn btn-danger fw-bold start-0 mb-0"
          data-bs-toggle="modal"
          data-bs-target="#payment"
        >
          Back
        </button>

        <!-- Buttons on the right -->
        <div class="d-flex">
          <button type="button" class="btn btn-primary">
            <a
              data-bs-dismiss="modal"
              class="nav-link text-white text-decoration-none"
              (click)="placeOrder()"
              >Confirm</a
            >
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
